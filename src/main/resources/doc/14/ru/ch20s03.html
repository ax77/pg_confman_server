<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>20.3. Подключения и аутентификация</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="runtime-config-connection"/>20.3. Подключения и аутентификация</h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="runtime-config-connection-settings"/>20.3.1. Параметры подключений</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><a id="guc-listen-addresses"/><span class="term"><code class="varname">listen_addresses</code> (<code class="type">string</code>) <a id="id-1.6.7.6.2.2.1.1.3" class="indexterm"/></span></dt><dd><p>Задаёт адреса TCP/IP, по которым сервер будет принимать подключения клиентских приложений. Это значение принимает форму списка, разделённого запятыми, из имён и/или числовых IP-адресов компьютеров. Особый элемент, <code class="literal">*</code>, обозначает все имеющиеся IP-интерфейсы. Запись <code class="literal">0.0.0.0</code> позволяет задействовать все адреса IPv4, а <code class="literal">::</code> — все адреса IPv6. Если список пуст, сервер не будет привязываться ни к какому IP-интерфейсу, а значит, подключиться к нему можно будет только через Unix-сокеты. По умолчанию этот параметр содержит <span class="systemitem">localhost</span>, что допускает подключение к серверу по TCP/IP только через локальный интерфейс <span class="quote">«<span class="quote">замыкания</span>»</span>. Хотя механизм аутентификации клиентов (см. <a class="xref" href="ch21.html" title="Глава 21. Аутентификация клиентского приложения">Главу 21</a>) позволяет гибко управлять доступом пользователей к серверу, параметр <code class="varname">listen_addresses</code> может ограничить интерфейсы, через которые будут приниматься соединения, что бывает полезно для предотвращения злонамеренных попыток подключения через незащищённые сетевые интерфейсы. Этот параметр можно задать только при запуске сервера.</p></dd><dt><a id="guc-port"/><span class="term"><code class="varname">port</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.2.2.2.1.3" class="indexterm"/></span></dt><dd><p>TCP-порт, открываемый сервером; по умолчанию, 5432. Заметьте, что этот порт используется для всех IP-адресов, через которые сервер принимает подключения. Этот параметр можно задать только при запуске сервера.</p></dd><dt><a id="guc-max-connections"/><span class="term"><code class="varname">max_connections</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.2.2.3.1.3" class="indexterm"/></span></dt><dd><p>Определяет максимальное число одновременных подключений к серверу БД. По умолчанию обычно это 100 подключений, но это число может быть меньше, если ядро накладывает свои ограничения (это определяется в процессе <span class="application">initdb</span>). Этот параметр можно задать только при запуске сервера.</p><p>Для ведомого сервера значение этого параметра должно быть больше или равно значению на ведущем. В противном случае на ведомом сервере не будут разрешены запросы.</p></dd><dt><a id="guc-superuser-reserved-connections"/><span class="term"><code class="varname">superuser_reserved_connections</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.2.2.4.1.3" class="indexterm"/></span></dt><dd><p>Определяет количество <span class="quote">«<span class="quote">слотов</span>»</span> подключений, которые <span class="productname">PostgreSQL</span> будет резервировать для суперпользователей. При этом всего одновременно активными могут быть максимум <a class="xref" href="ch20s03.html#guc-max-connections">max_connections</a> подключений. Когда число активных одновременных подключений больше или равно <code class="varname">max_connections</code> минус <code class="varname">superuser_reserved_connections</code>, принимаются только подключения суперпользователей, а все другие подключения, в том числе подключения для репликации, запрещаются.</p><p>По умолчанию резервируются три соединения. Это значение должно быть меньше значения <code class="varname">max_connections</code>. Задать этот параметр можно только при запуске сервера.</p></dd><dt><a id="guc-unix-socket-directories"/><span class="term"><code class="varname">unix_socket_directories</code> (<code class="type">string</code>) <a id="id-1.6.7.6.2.2.5.1.3" class="indexterm"/></span></dt><dd><p>Задаёт каталог Unix-сокета, через который сервер будет принимать подключения клиентских приложений. Создать несколько сокетов можно, перечислив в этом значении несколько каталогов через запятую. Пробелы между элементами этого списка игнорируются; если в пути каталога содержатся пробелы, его нужно заключать в двойные кавычки. При пустом значении сервер не будет работать с Unix-сокетами, в этом случае к нему можно будет подключиться только по TCP/IP.</p><p>Значение, которое начинается с <code class="literal">@</code>, указывает, что будет создан сокет домена Unix в абстрактном пространстве имён (в настоящее время поддерживается в Linux и Windows). Такое значение задаёт не <span class="quote">«<span class="quote">каталог</span>»</span>, а префикс, из которого получается фактическое имя сокета таким же образом, как и для пространства имён файловой системы. Хотя префикс имени абстрактного сокета может быть произвольным, поскольку он не задаёт путь в файловой системе, принято использовать значения, подобные путям в файловой системе, такие как <code class="literal">@/tmp</code>.</p><p>Значение по умолчанию обычно <code class="filename">/tmp</code>, но оно может быть изменено во время сборки. В Windows по умолчанию это значение не задано, то есть сокет домена Unix не создаётся. Этот параметр можно установить только при запуске сервера.</p><p>Помимо самого файла сокета, который называется <code class="literal">.s.PGSQL.<em class="replaceable"><code>nnnn</code></em></code> (где <em class="replaceable"><code>nnnn</code></em> — номер порта сервера), в каждом каталоге <code class="varname">unix_socket_directories</code> создаётся обычный файл <code class="literal">.s.PGSQL.<em class="replaceable"><code>nnnn</code></em>.lock</code>. Ни в коем случае не удаляйте эти файлы вручную. Для сокетов в абстрактном пространстве имён файл <code class="literal">.lock</code> не создаётся.</p></dd><dt><a id="guc-unix-socket-group"/><span class="term"><code class="varname">unix_socket_group</code> (<code class="type">string</code>) <a id="id-1.6.7.6.2.2.6.1.3" class="indexterm"/></span></dt><dd><p>Задаёт группу-владельца Unix-сокетов. (Пользователем-владельцем сокетов всегда будет пользователь, запускающий сервер.) В сочетании с <code class="varname">unix_socket_permissions</code> данный параметр можно использовать как дополнительный механизм управления доступом к Unix-сокетам. По умолчанию он содержит пустую строку, то есть группой-владельцем становится основная группа пользователя, запускающего сервер. Задать этот параметр можно только при запуске сервера.</p><p>В Windows данный параметр не поддерживается, так что любое его значение ни на что не влияет. Кроме того, сокеты в абстрактном пространстве имён не имеют владельца файла, поэтому для таких сокетов данный параметр также игнорируется.</p></dd><dt><a id="guc-unix-socket-permissions"/><span class="term"><code class="varname">unix_socket_permissions</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.2.2.7.1.3" class="indexterm"/></span></dt><dd><p>Задаёт права доступа к Unix-сокетам. Для Unix-сокетов применяется обычный набор разрешений Unix. Значение параметра ожидается в числовом виде, который принимают функции <code class="function">chmod</code> и <code class="function">umask</code>. (Для применения обычного восьмеричного формата число должно начинаться с <code class="literal">0</code> (нуля).)</p><p>По умолчанию действуют разрешения <code class="literal">0777</code>, при которых подключаться к сокету могут все. Другие разумные варианты — <code class="literal">0770</code> (доступ имеет только пользователь и группа, см. также <code class="varname">unix_socket_group</code>) и <code class="literal">0700</code> (только пользователь). (Заметьте, что для Unix-сокетов требуется только право на запись, так что добавлять или отзывать права на чтение/выполнение не имеет смысла.)</p><p>Этот механизм управления доступом не зависит от описанного в <a class="xref" href="ch21.html" title="Глава 21. Аутентификация клиентского приложения">Главе 21</a>.</p><p>Этот параметр можно задать только при запуске сервера.</p><p>Данный параметр неприменим для некоторых систем, в частности, Solaris (а именно Solaris 10), которые полностью игнорируют разрешения для сокетов. В таких системах примерно тот же эффект можно получить, указав в параметре <code class="varname">unix_socket_directories</code> каталог, доступ к которому ограничен должным образом.</p><p>Сокеты в абстрактном пространстве имён не имеют прав доступа к файлам, поэтому для таких сокетов данный параметр также игнорируется.</p></dd><dt><a id="guc-bonjour"/><span class="term"><code class="varname">bonjour</code> (<code class="type">boolean</code>) <a id="id-1.6.7.6.2.2.8.1.3" class="indexterm"/></span></dt><dd><p>Включает объявления о существовании сервера посредством <span class="productname">Bonjour</span>. По умолчанию выключен. Задать этот параметр можно только при запуске сервера.</p></dd><dt><a id="guc-bonjour-name"/><span class="term"><code class="varname">bonjour_name</code> (<code class="type">string</code>) <a id="id-1.6.7.6.2.2.9.1.3" class="indexterm"/></span></dt><dd><p>Задаёт имя службы в среде <span class="productname">Bonjour</span>. Если значение этого параметра — пустая строка (<code class="literal">''</code>) (это значение по умолчанию), в качестве этого имени используется имя компьютера. Этот параметр игнорируется, если сервер был скомпилирован без поддержки <span class="productname">Bonjour</span>. Задать этот параметр можно только при запуске сервера.</p></dd><dt><a id="guc-tcp-keepalives-idle"/><span class="term"><code class="varname">tcp_keepalives_idle</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.2.2.10.1.3" class="indexterm"/></span></dt><dd><p>Задаёт период отсутствия сетевой активности, по истечении которого операционная система должна отправить клиенту TCP-сигнал сохранения соединения. Если это значение задаётся без единиц измерения, оно считается заданным в секундах. При значении 0 (по умолчанию) действует величина, принятая по умолчанию в операционной системе. Этот параметр поддерживается только в системах, воспринимающих параметр сокета <code class="symbol">TCP_KEEPIDLE</code> или равнозначный, а также в Windows; в других системах он должен быть равен нулю. В сеансах, подключённых через Unix-сокеты, он игнорируется и всегда считается равным 0.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>В Windows при присваивании нулевого значения этот период устанавливается равным 2 часам, так как Windows не позволяет прочитать системное значение по умолчанию.</p></div></dd><dt><a id="guc-tcp-keepalives-interval"/><span class="term"><code class="varname">tcp_keepalives_interval</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.2.2.11.1.3" class="indexterm"/></span></dt><dd><p>Задаёт интервал, по истечении которого следует повторять TCP-сигнал сохранения соединения, если от клиента не получено подтверждение предыдущего сигнала. Если это значение задаётся без единиц измерения, оно считается заданным в секундах. При значении 0 (по умолчанию) действует величина, принятая по умолчанию в операционной системе. Этот параметр поддерживается только в системах, воспринимающих параметр сокета <code class="symbol">TCP_KEEPINTVL</code> или равнозначный, а также в Windows; в других системах он должен быть равен нулю. В сеансах, подключённых через Unix-сокеты, он игнорируется и всегда считается равным 0.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>В Windows при присваивании нулевого значения интервал устанавливается равным 1 секунде, так как Windows не позволяет прочитать системное значение по умолчанию.</p></div></dd><dt><a id="guc-tcp-keepalives-count"/><span class="term"><code class="varname">tcp_keepalives_count</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.2.2.12.1.3" class="indexterm"/></span></dt><dd><p>Задаёт число TCP-сигналов сохранения соединения, которые могут быть потеряны до того, как соединение сервера с клиентом будет признано прерванным. При значении 0 (по умолчанию) действует величина, принятая по умолчанию в операционной системе. Этот параметр поддерживается только в системах, воспринимающих параметр сокета <code class="symbol">TCP_KEEPCNT</code> или равнозначный; в других системах он должен быть равен нулю. В сеансах, подключённых через Unix-сокеты, он игнорируется и всегда считается равным 0.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>В Windows данный параметр не поддерживается и должен быть равен нулю.</p></div></dd><dt><a id="guc-tcp-user-timeout"/><span class="term"><code class="varname">tcp_user_timeout</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.2.2.13.1.3" class="indexterm"/></span></dt><dd><p>Задаёт интервал, в течение которого переданные данные могут оставаться неподтверждёнными, прежде чем будет принято решение о принудительном закрытии TCP-соединения. Если это значение задаётся без единиц измерения, оно считается заданным в миллисекундах. При значении 0 (по умолчанию) действует величина, принятая по умолчанию в операционной системе. Этот параметр поддерживается только в системах, воспринимающих параметр сокета <code class="symbol">TCP_USER_TIMEOUT</code>; в других системах он должен быть равен нулю. В сеансах, подключённых через доменные сокеты Unix, он игнорируется и всегда считается равным 0.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>В Windows данный параметр не поддерживается и должен быть равен нулю.</p></div></dd><dt><a id="guc-client-connection-check-interval"/><span class="term"><code class="varname">client_connection_check_interval</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.2.2.14.1.3" class="indexterm"/></span></dt><dd><p>Задаёт интервал между необязательными проверками соединения сервера с клиентом в процессе выполнения запроса. Такая проверка, заключающаяся в опросе состояния сокета, позволяет раньше прерывать длительные запросы, если ядро сообщает, что соединение закрыто.</p><p>Этот параметр на данный момент доступен только в системах, которые поддерживают нестандартное расширение <code class="symbol">POLLRDHUP</code> для системного вызова <code class="symbol">poll</code> (к таким системам относится Linux).</p><p>Если это значение задаётся без единиц измерения, оно считается заданным в миллисекундах. Значение по умолчанию — <code class="literal">0</code>, то есть проверка соединения отключена. Если соединение не проверяется, сервер обнаружит разрыв соединения только при следующем обращении к сокету, когда будет передавать, ожидать или читать данные.</p><p>Чтобы само ядро могло надёжно и в течение известного периода времени обнаруживать потерянные TCP-соединения во всех сценариях, включая сбой сети, также может потребоваться изменить параметры сохранения TCP-соединения в операционной системе или параметры <span class="productname">PostgreSQL</span> <a class="xref" href="ch20s03.html#guc-tcp-keepalives-idle">tcp_keepalives_idle</a>, <a class="xref" href="ch20s03.html#guc-tcp-keepalives-interval">tcp_keepalives_interval</a> и <a class="xref" href="ch20s03.html#guc-tcp-keepalives-count">tcp_keepalives_count</a>.</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="runtime-config-connection-authentication"/>20.3.2. Аутентификация</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><a id="guc-authentication-timeout"/><span class="term"><code class="varname">authentication_timeout</code> (<code class="type">integer</code>) <a id="id-1.6.7.6.3.2.1.1.3" class="indexterm"/> <a id="id-1.6.7.6.3.2.1.1.4" class="indexterm"/> <a id="id-1.6.7.6.3.2.1.1.5" class="indexterm"/></span></dt><dd><p>Максимальное время, за которое должна произойти аутентификация. Если потенциальный клиент не сможет пройти проверку подлинности за это время, сервер закроет соединение. Благодаря этому зависшие при подключении клиенты не будут занимать соединения неограниченно долго. Если это значение задаётся без единиц измерения, оно считается заданным в миллисекундах. Значение этого параметра по умолчанию — одна минута (<code class="literal">1m</code>). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt><a id="guc-password-encryption"/><span class="term"><code class="varname">password_encryption</code> (<code class="type">enum</code>) <a id="id-1.6.7.6.3.2.2.1.3" class="indexterm"/></span></dt><dd><p>Когда в <a class="xref" href="rn01re146.html" title="CREATE ROLE"><span class="refentrytitle">CREATE ROLE</span></a> или <a class="xref" href="rn01re94.html" title="ALTER ROLE"><span class="refentrytitle">ALTER ROLE</span></a> задаётся пароль, этот параметр определяет, каким алгоритмом его шифровать. Возможные значения данного параметра — <code class="literal">scram-sha-256</code> (пароль будет шифроваться алгоритмом SCRAM-SHA-256) и <code class="literal">md5</code> (пароль сохраняется в виде хеша MD5). Значение по умолчанию — <code class="literal">scram-sha-256</code>.</p><p>Учтите, что старые клиенты могут не поддерживать механизм проверки подлинности SCRAM и поэтому не будут работать с паролями, зашифрованными алгоритмом SCRAM-SHA-256. За подробностями обратитесь к <a class="xref" href="ch21s05.html" title="21.5. Аутентификация password">Разделу 21.5</a>.</p></dd><dt><a id="guc-krb-server-keyfile"/><span class="term"><code class="varname">krb_server_keyfile</code> (<code class="type">string</code>) <a id="id-1.6.7.6.3.2.3.1.3" class="indexterm"/></span></dt><dd><p>Задаёт расположение файла ключей Kerberos для данного сервера. Значение по умолчанию: <code class="filename">FILE:/usr/local/pgsql/etc/krb5.keytab</code> (каталог определяется значением параметра <code class="varname">sysconfdir</code> в процессе сборки; чтобы его узнать, выполните <code class="literal">pg_config --sysconfdir</code>). Если этот параметр содержит пустую строку, используется значение по умолчанию, зависящее от системы. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. За подробностями обратитесь к <a class="xref" href="ch21s06.html" title="21.6. Аутентификация GSSAPI">Разделу 21.6</a>.</p></dd><dt><a id="guc-krb-caseins-users"/><span class="term"><code class="varname">krb_caseins_users</code> (<code class="type">boolean</code>) <a id="id-1.6.7.6.3.2.4.1.3" class="indexterm"/></span></dt><dd><p>Определяет, должны ли имена пользователей GSSAPI обрабатываться без учёта регистра. По умолчанию значение этого параметра — <code class="literal">off</code> (регистр учитывается). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt><a id="guc-db-user-namespace"/><span class="term"><code class="varname">db_user_namespace</code> (<code class="type">boolean</code>) <a id="id-1.6.7.6.3.2.5.1.3" class="indexterm"/></span></dt><dd><p>Этот параметр позволяет относить имена пользователей к базам данных. По умолчанию он имеет значение off (выключен). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p><p>Если он включён, имена создаваемых пользователей должны иметь вид <em class="replaceable"><code>имя_пользователя@база_данных</code></em>. Когда подключающийся клиент передаёт <em class="replaceable"><code>имя_пользователя</code></em>, к этому имени добавляется <code class="literal">@</code> с именем базы данных, и сервер идентифицирует пользователя по этому полному имени. Заметьте, что для создания пользователя с именем, содержащим <code class="literal">@</code>, в среде SQL потребуется заключить это имя в кавычки.</p><p>Когда этот параметр включён, он не мешает создавать и использовать обычных глобальных пользователей. Чтобы подключиться с таким именем пользователя, достаточно добавить к имени <code class="literal">@</code>, например так: <code class="literal">joe@</code>. Получив такое имя, сервер отбросит <code class="literal">@</code>, и будет идентифицировать пользователя по начальному имени.</p><p>Параметр <code class="varname">db_user_namespace</code> порождает расхождение между именами пользователей на стороне сервера и клиента. Но проверки подлинности всегда выполняются с именем с точки зрения сервера, так что, настраивая аутентификацию, следует указывать серверное представление имени, а не клиентское. Так как метод аутентификации <code class="literal">md5</code> подмешивает имя пользователя в качестве соли и на стороне сервера, и на стороне клиента, при включённом параметре <code class="varname">db_user_namespace</code> использовать <code class="literal">md5</code> невозможно.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>Эта возможность предлагается в качестве временной меры, пока не будет найдено полноценное решение. Тогда этот параметр будет ликвидирован.</p></div></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="runtime-config-connection-ssl"/>20.3.3. SSL</h2></div></div></div><p>Дополнительную информацию о настройке SSL можно получить в <a class="xref" href="ch19s09.html" title="19.9. Защита соединений TCP/IP с применением SSL">Разделе 19.9</a>.</p><div class="variablelist"><dl class="variablelist"><dt><a id="guc-ssl"/><span class="term"><code class="varname">ssl</code> (<code class="type">boolean</code>) <a id="id-1.6.7.6.4.3.1.1.3" class="indexterm"/></span></dt><dd><p>Разрешает подключения <acronym class="acronym">SSL</acronym>. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Значение по умолчанию — <code class="literal">off</code>.</p></dd><dt><a id="guc-ssl-ca-file"/><span class="term"><code class="varname">ssl_ca_file</code> (<code class="type">string</code>) <a id="id-1.6.7.6.4.3.2.1.3" class="indexterm"/></span></dt><dd><p>Задаёт имя файла, содержащего сертификаты центров сертификации (ЦС) для SSL-сервера. При указании относительного пути он рассматривается от каталога данных. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. По умолчанию этот параметр пуст, что означает, что файл сертификатов ЦС не загружается и проверка клиентских сертификатов не производится.</p></dd><dt><a id="guc-ssl-cert-file"/><span class="term"><code class="varname">ssl_cert_file</code> (<code class="type">string</code>) <a id="id-1.6.7.6.4.3.3.1.3" class="indexterm"/></span></dt><dd><p>Задаёт имя файла, содержащего сертификат этого SSL-сервера. При указании относительного пути он рассматривается от каталога данных. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Значение по умолчанию — <code class="filename">server.crt</code>.</p></dd><dt><a id="guc-ssl-crl-file"/><span class="term"><code class="varname">ssl_crl_file</code> (<code class="type">string</code>) <a id="id-1.6.7.6.4.3.4.1.3" class="indexterm"/></span></dt><dd><p>Задаёт имя файла, содержащего список отзыва клиентских сертификатов (CRL, Certificate Revocation List) для SSL. При указании относительного пути он рассматривается от каталога данных. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. По умолчанию этот параметр пуст, что означает, что файл CRL не загружается (если не задан параметр <a class="xref" href="ch20s03.html#guc-ssl-crl-dir">ssl_crl_dir</a>).</p></dd><dt><a id="guc-ssl-crl-dir"/><span class="term"><code class="varname">ssl_crl_dir</code> (<code class="type">string</code>) <a id="id-1.6.7.6.4.3.5.1.3" class="indexterm"/></span></dt><dd><p>Задаёт имя каталога, содержащего список отзыва клиентских сертификатов (CRL, Certificate Revocation List) для SSL. При указании относительного пути он рассматривается от каталога данных. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. По умолчанию этот параметр пуст, что означает, что файл CRL не загружается (если не задан параметр <a class="xref" href="ch20s03.html#guc-ssl-crl-file">ssl_crl_file</a>).</p><p>Каталог необходимо подготовить с помощью команды <span class="productname">OpenSSL</span> <code class="literal">openssl rehash</code> или <code class="literal">c_rehash</code>. За подробностями обратитесь к документации <span class="productname">OpenSSL</span>.</p><p>Когда применяется этот параметр, списки отзыва сертификатов (Certificate Revocation List, CRL) в указанном каталоге загружаются при необходимости во время подключения. Новые CRL в этом каталоге будут использоваться сразу по мере добавления. Это отличает данный параметр от <a class="xref" href="ch20s03.html#guc-ssl-crl-file">ssl_crl_file</a>, с которым CRL загружаются из файла во время запуска сервера или при перезагрузке конфигурации. Эти параметры можно использовать вместе.</p></dd><dt><a id="guc-ssl-key-file"/><span class="term"><code class="varname">ssl_key_file</code> (<code class="type">string</code>) <a id="id-1.6.7.6.4.3.6.1.3" class="indexterm"/></span></dt><dd><p>Задаёт имя файла, содержащего закрытый ключ SSL-сервера. При указании относительного пути он рассматривается от каталога данных. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Значение по умолчанию — <code class="filename">server.key</code>.</p></dd><dt><a id="guc-ssl-ciphers"/><span class="term"><code class="varname">ssl_ciphers</code> (<code class="type">string</code>) <a id="id-1.6.7.6.4.3.7.1.3" class="indexterm"/></span></dt><dd><p>Задаёт список наборов шифров <acronym class="acronym">SSL</acronym>, которые могут применяться для SSL-соединений. Синтаксис этого параметра и список поддерживаемых значений можно найти на странице <span class="citerefentry"><span class="refentrytitle">ciphers</span></span> руководства по <span class="application">OpenSSL</span>. Этот параметр действует только для подключений TLS версии 1.2 и ниже. Для подключений TLS версии 1.3 возможность выбора шифров в настоящее время отсутствует. Значение по умолчанию — <code class="literal">HIGH:MEDIUM:+3DES:!aNULL</code>. Обычно оно вполне приемлемо при отсутствии особых требований по безопасности.</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p><p>Объяснение значения по умолчанию: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">HIGH</code></span></dt><dd><p>Наборы шифров, в которых используются шифры из группы высокого уровня (<code class="literal">HIGH</code>), (например: AES, Camellia, 3DES)</p></dd><dt><span class="term"><code class="literal">MEDIUM</code></span></dt><dd><p>Наборы шифров, в которых используются шифры из группы среднего уровня (<code class="literal">MEDIUM</code>) (например, RC4, SEED)</p></dd><dt><span class="term"><code class="literal">+3DES</code></span></dt><dd><p>Порядок шифров для группы <code class="literal">HIGH</code> по умолчанию в OpenSSL определён некорректно. В нём 3DES оказывается выше AES128, что неправильно, так как он считается менее безопасным, чем AES128, и работает гораздо медленнее. Включение <code class="literal">+3DES</code> меняет этот порядок, чтобы данный алгоритм следовал после всех шифров групп <code class="literal">HIGH</code> и <code class="literal">MEDIUM</code>.</p></dd><dt><span class="term"><code class="literal">!aNULL</code></span></dt><dd><p>Отключает наборы анонимных шифров, не требующие проверки подлинности. Такие наборы уязвимы для атак с посредником (<acronym class="acronym">MITM</acronym>), поэтому использовать их не следует.</p></dd></dl></div><p>Конкретные наборы шифров и их свойства очень различаются от версии к версии <span class="productname">OpenSSL</span>. Чтобы получить фактическую информацию о них для текущей установленной версии <span class="productname">OpenSSL</span>, выполните команду <code class="literal">openssl ciphers -v 'HIGH:MEDIUM:+3DES:!aNULL'</code>. Учтите, что этот список фильтруется во время выполнения, в зависимости от типа ключа сервера.</p></dd><dt><a id="guc-ssl-prefer-server-ciphers"/><span class="term"><code class="varname">ssl_prefer_server_ciphers</code> (<code class="type">boolean</code>) <a id="id-1.6.7.6.4.3.8.1.3" class="indexterm"/></span></dt><dd><p>Определяет, должны ли шифры SSL сервера предпочитаться клиентским. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Значение по умолчанию — <code class="literal">on</code>.</p><p>В старых версиях PostgreSQL этот параметр отсутствовал и предпочтение отдавалось выбору клиента. Введён этот параметр в основном для обеспечения совместимости с этими версиями. Вообще же обычно лучше использовать конфигурацию сервера, так как в конфигурации на стороне клиента более вероятны ошибки.</p></dd><dt><a id="guc-ssl-ecdh-curve"/><span class="term"><code class="varname">ssl_ecdh_curve</code> (<code class="type">string</code>) <a id="id-1.6.7.6.4.3.9.1.3" class="indexterm"/></span></dt><dd><p>Задаёт имя кривой для использования при обмене ключами <acronym class="acronym">ECDH</acronym>. Эту кривую должны поддерживать все подключающиеся клиенты. Это не обязательно должна быть кривая, с которой был получен ключ сервера. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Значение по умолчанию — <code class="literal">prime256v1</code>.</p><p>Наиболее распространённые кривые в <span class="productname">OpenSSL</span> — <code class="literal">prime256v1</code> (NIST P-256), <code class="literal">secp384r1</code> (NIST P-384), <code class="literal">secp521r1</code> (NIST P-521). Полный список доступных кривых можно получить командой <span class="command"><strong>openssl ecparam -list_curves</strong></span>. Однако не все из них пригодны для <acronym class="acronym">TLS</acronym>.</p></dd><dt><a id="guc-ssl-min-protocol-version"/><span class="term"><code class="varname">ssl_min_protocol_version</code> (<code class="type">enum</code>) <a id="id-1.6.7.6.4.3.10.1.3" class="indexterm"/></span></dt><dd><p>Задаёт минимальную версию протокола SSL/TLS, которая может использоваться. В настоящее время допускаются версии <code class="literal">TLSv1</code>, <code class="literal">TLSv1.1</code>, <code class="literal">TLSv1.2</code>, <code class="literal">TLSv1.3</code>. Старые версии библиотеки <span class="productname">OpenSSL</span> могут не поддерживать все варианты; при выборе неподдерживаемой версии будет выдана ошибка. Версии протокола до TLS 1.0, а именно SSL v.2 и v.3, не будут использоваться в любом случае.</p><p>Значение по умолчанию — <code class="literal">TLSv1.2</code>, что соответствует рекомендациям, актуальным в индустрии на момент написания этой документации.</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt><a id="guc-ssl-max-protocol-version"/><span class="term"><code class="varname">ssl_max_protocol_version</code> (<code class="type">enum</code>) <a id="id-1.6.7.6.4.3.11.1.3" class="indexterm"/></span></dt><dd><p>Задаёт максимальную версию протокола SSL/TLS, которая может использоваться. Допускаются те же версии, что и для <a class="xref" href="ch20s03.html#guc-ssl-min-protocol-version">ssl_min_protocol_version</a>, а также пустая строка, обозначающая отсутствие ограничения версии. По умолчанию версии не ограничиваются. Устанавливать максимальную возможную версию протокола полезно прежде всего для тестирования или в случае проблем при использовании нового протокола какими-то компонентами.</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt><a id="guc-ssl-dh-params-file"/><span class="term"><code class="varname">ssl_dh_params_file</code> (<code class="type">string</code>) <a id="id-1.6.7.6.4.3.12.1.3" class="indexterm"/></span></dt><dd><p>Задаёт имя файла с параметрами алгоритма Диффи-Хеллмана, применяемого для так называемого эфемерного семейства DH шифров SSL. По умолчанию значение пустое, то есть используются стандартные параметры DH, заданные при компиляции. Использование нестандартных параметров DH защищает от атаки, рассчитанной на взлом хорошо известных встроенных параметров DH. Создать собственный файл с параметрами DH можно, выполнив команду <span class="command"><strong>openssl dhparam -out dhparams.pem 2048</strong></span>.</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt><a id="guc-ssl-passphrase-command"/><span class="term"><code class="varname">ssl_passphrase_command</code> (<code class="type">string</code>) <a id="id-1.6.7.6.4.3.13.1.3" class="indexterm"/></span></dt><dd><p>Задаёт внешнюю команду, которая будет вызываться, когда потребуется пароль для расшифровывания SSL-файла, например закрытого ключа. По умолчанию этот параметр не определён, то есть пароль будет запрашиваться встроенным механизмом.</p><p>Эта команда должна вывести пароль на устройство стандартного вывода и завершиться с кодом 0. В строке параметра <code class="literal">%p</code> заменяется строкой приглашения. (Напишите <code class="literal">%%</code>, чтобы вывести <code class="literal">%</code> буквально.) Заметьте, что строка приглашения, вероятно, будет содержать пробелы, так что её нужно будет заключить в кавычки. Если в конце добавлен один перевод строки, он будет отфильтрован при выводе.</p><p>Эта команда не обязательно должна запрашивать пароль у пользователя. Она может считать его из файла, извлечь из системной связки ключей или получить другими подобными средствами. Ответственность за выбор достаточно безопасного механизма возлагается на пользователя.</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt><a id="guc-ssl-passphrase-command-supports-reload"/><span class="term"><code class="varname">ssl_passphrase_command_supports_reload</code> (<code class="type">boolean</code>) <a id="id-1.6.7.6.4.3.14.1.3" class="indexterm"/></span></dt><dd><p>Этот параметр определяет, будет ли заданная параметром <code class="varname">ssl_passphrase_command</code> команда, запрашивающая пароль, также вызываться при перезагрузке конфигурации, если для файла ключа требуется пароль. Когда этот параметр отключён (по умолчанию), команда <code class="varname">ssl_passphrase_command</code> будет игнорироваться при перезагрузке, и конфигурация SSL не будет обновляться, если требуется пароль. Это значение подходит для команды, требующей для ввода пароля наличия терминала TTY, который может быть недоступен в процессе работы сервера. Включение данного параметра может быть уместно, если, например, пароль считывается из файла.</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd></dl></div></div></div></body></html>