<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>20.10. Автоматическая очистка</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="runtime-config-autovacuum"/>20.10. Автоматическая очистка</h1></div></div></div><a id="id-1.6.7.13.2" class="indexterm"/><p>Эти параметры управляют поведением механизма <em class="firstterm">автоочистки</em>. За дополнительными сведениями обратитесь к <a class="xref" href="ch25.html#autovacuum" title="25.1.6. Демон автоочистки">Подразделу 25.1.6</a>. Заметьте, что многие из этих параметров могут быть переопределены на уровне таблиц; см. <a class="xref" href="rn01re153.html#sql-createtable-storage-parameters" title="Параметры хранения">Параметры хранения</a>.</p><div class="variablelist"><dl class="variablelist"><dt><a id="guc-autovacuum"/><span class="term"><code class="varname">autovacuum</code> (<code class="type">boolean</code>) <a id="id-1.6.7.13.4.1.1.3" class="indexterm"/></span></dt><dd><p>Управляет состоянием демона, запускающего автоочистку. По умолчанию он включён, но чтобы автоочистка работала, нужно также включить <a class="xref" href="ch20s09.html#guc-track-counts">track_counts</a>. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако автоочистку можно отключить для отдельных таблиц, изменив их параметры хранения.</p><p>Заметьте, что даже если этот параметр отключён, система будет запускать процессы автоочистки, когда это необходимо для предотвращения зацикливания идентификаторов транзакций. За дополнительными сведениями обратитесь к <a class="xref" href="ch25.html#vacuum-for-wraparound" title="25.1.5. Предотвращение ошибок из-за зацикливания счётчика транзакций">Подразделу 25.1.5</a>.</p></dd><dt><a id="guc-autovacuum-max-workers"/><span class="term"><code class="varname">autovacuum_max_workers</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.2.1.3" class="indexterm"/></span></dt><dd><p>Задаёт максимальное число процессов автоочистки (не считая процесс, запускающий автоочистку), которые могут выполняться одновременно. По умолчанию это число равно трём. Задать этот параметр можно только при запуске сервера.</p></dd><dt><a id="guc-autovacuum-naptime"/><span class="term"><code class="varname">autovacuum_naptime</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.3.1.3" class="indexterm"/></span></dt><dd><p>Задаёт минимальную задержку между двумя запусками автоочистки для отдельной базы данных. Демон автоочистки проверяет базу данных через заданный интервал времени и выдаёт команды <span class="command"><strong>VACUUM</strong></span> и <span class="command"><strong>ANALYZE</strong></span>, когда это требуется для таблиц этой базы. Если это значение задаётся без единиц измерения, оно считается заданным в секундах. По умолчанию задержка равна одной минуте (<code class="literal">1min</code>). Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt><a id="guc-autovacuum-vacuum-threshold"/><span class="term"><code class="varname">autovacuum_vacuum_threshold</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.4.1.3" class="indexterm"/></span></dt><dd><p>Задаёт минимальное число изменённых или удалённых кортежей, при котором будет выполняться <span class="command"><strong>VACUUM</strong></span> для отдельно взятой таблицы. Значение по умолчанию — 50 кортежей. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt><a id="guc-autovacuum-vacuum-insert-threshold"/><span class="term"><code class="varname">autovacuum_vacuum_insert_threshold</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.5.1.3" class="indexterm"/></span></dt><dd><p>Задаёт число добавленных кортежей, при достижении которого будет выполняться <span class="command"><strong>VACUUM</strong></span> для отдельно взятой таблицы. Значение по умолчанию — 1000 кортежей. При значении -1 процедура автоочистки не будет производить операции <span class="command"><strong>VACUUM</strong></span> с таблицами в зависимости от числа добавленных строк. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt><a id="guc-autovacuum-analyze-threshold"/><span class="term"><code class="varname">autovacuum_analyze_threshold</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.6.1.3" class="indexterm"/></span></dt><dd><p>Задаёт минимальное число добавленных, изменённых или удалённых кортежей, при котором будет выполняться <span class="command"><strong>ANALYZE</strong></span> для отдельно взятой таблицы. Значение по умолчанию — 50 кортежей. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt><a id="guc-autovacuum-vacuum-scale-factor"/><span class="term"><code class="varname">autovacuum_vacuum_scale_factor</code> (<code class="type">floating point</code>) <a id="id-1.6.7.13.4.7.1.3" class="indexterm"/></span></dt><dd><p>Задаёт процент от размера таблицы, который будет добавляться к <code class="varname">autovacuum_vacuum_threshold</code> при выборе порога срабатывания команды <span class="command"><strong>VACUUM</strong></span>. Значение по умолчанию — 0.2 (20% от размера таблицы). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt><a id="guc-autovacuum-vacuum-insert-scale-factor"/><span class="term"><code class="varname">autovacuum_vacuum_insert_scale_factor</code> (<code class="type">floating point</code>) <a id="id-1.6.7.13.4.8.1.3" class="indexterm"/></span></dt><dd><p>Задаёт процент от размера таблицы, который будет добавляться к <code class="varname">autovacuum_vacuum_insert_threshold</code> при выборе порога срабатывания команды <span class="command"><strong>VACUUM</strong></span>. Значение по умолчанию — 0.2 (20% от размера таблицы). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt><a id="guc-autovacuum-analyze-scale-factor"/><span class="term"><code class="varname">autovacuum_analyze_scale_factor</code> (<code class="type">floating point</code>) <a id="id-1.6.7.13.4.9.1.3" class="indexterm"/></span></dt><dd><p>Задаёт процент от размера таблицы, который будет добавляться к <code class="varname">autovacuum_analyze_threshold</code> при выборе порога срабатывания команды <span class="command"><strong>ANALYZE</strong></span>. Значение по умолчанию — 0.1 (10% от размера таблицы). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt><a id="guc-autovacuum-freeze-max-age"/><span class="term"><code class="varname">autovacuum_freeze_max_age</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.10.1.3" class="indexterm"/></span></dt><dd><p>Задаёт максимальный возраст (в транзакциях) для поля <code class="structname">pg_class</code>.<code class="structfield">relfrozenxid</code> некоторой таблицы, при достижении которого будет запущена операция <span class="command"><strong>VACUUM</strong></span> для предотвращения зацикливания идентификаторов транзакций в этой таблице. Заметьте, что система запустит процессы автоочистки для предотвращения зацикливания, даже если для всех других целей автоочистка отключена.</p><p>При очистке могут также удаляться старые файлы из подкаталога <code class="filename">pg_xact</code>, поэтому значение по умолчанию сравнительно мало — 200 миллионов транзакций. Задать этот параметр можно только при запуске сервера, но для отдельных таблиц его можно определить по-другому, изменив их параметры хранения. За дополнительными сведениями обратитесь к <a class="xref" href="ch25.html#vacuum-for-wraparound" title="25.1.5. Предотвращение ошибок из-за зацикливания счётчика транзакций">Подразделу 25.1.5</a>.</p></dd><dt><a id="guc-autovacuum-multixact-freeze-max-age"/><span class="term"><code class="varname">autovacuum_multixact_freeze_max_age</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.11.1.3" class="indexterm"/></span></dt><dd><p>Задаёт максимальный возраст (в мультитранзакциях) для поля <code class="structname">pg_class</code>.<code class="structfield">relminmxid</code> таблицы, при достижении которого будет запущена операция <span class="command"><strong>VACUUM</strong></span> для предотвращения зацикливания идентификаторов мультитранзакций в этой таблице. Заметьте, что система запустит процессы автоочистки для предотвращения зацикливания, даже если для всех других целей автоочистка отключена.</p><p>При очистке мультитранзакций могут также удаляться старые файлы из подкаталогов <code class="filename">pg_multixact/members</code> и <code class="filename">pg_multixact/offsets</code>, поэтому значение по умолчанию сравнительно мало — 400 миллионов мультитранзакций. Этот параметр можно задать только при запуске сервера, но для отдельных таблиц его можно определить по-другому, изменив их параметры хранения. За дополнительными сведениями обратитесь к <a class="xref" href="ch25.html#vacuum-for-multixact-wraparound" title="25.1.5.1. Мультитранзакции и зацикливание">Подразделу 25.1.5.1</a>.</p></dd><dt><a id="guc-autovacuum-vacuum-cost-delay"/><span class="term"><code class="varname">autovacuum_vacuum_cost_delay</code> (<code class="type">floating point</code>) <a id="id-1.6.7.13.4.12.1.3" class="indexterm"/></span></dt><dd><p>Задаёт задержку при превышении предела стоимости, которая будет применяться при автоматических операциях <span class="command"><strong>VACUUM</strong></span>. Если это значение задаётся без единиц измерения, оно считается заданным в миллисекундах. При значении -1 применяется обычная задержка <a class="xref" href="ch20s04.html#guc-vacuum-cost-delay">vacuum_cost_delay</a>. Значение по умолчанию — 2 миллисекунды. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако его можно переопределить для отдельных таблиц, изменив их параметры хранения.</p></dd><dt><a id="guc-autovacuum-vacuum-cost-limit"/><span class="term"><code class="varname">autovacuum_vacuum_cost_limit</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.13.1.3" class="indexterm"/></span></dt><dd><p>Задаёт предел стоимости, который будет учитываться при автоматических операциях <span class="command"><strong>VACUUM</strong></span>. При значении -1 (по умолчанию) применяется обычное значение <a class="xref" href="ch20s04.html#guc-vacuum-cost-limit">vacuum_cost_limit</a>. Заметьте, что это значение распределяется пропорционально среди всех работающих процессов автоочистки, если их больше одного, так что сумма ограничений всех процессов никогда не превосходит данный предел. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако его можно переопределить для отдельных таблиц, изменив их параметры хранения.</p></dd></dl></div></div></body></html>