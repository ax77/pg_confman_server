<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>20.9. Статистика времени выполнения</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="runtime-config-statistics"/>20.9. Статистика времени выполнения</h1></div></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="runtime-config-statistics-collector"/>20.9.1. Сбор статистики по запросам и индексам</h2></div></div></div><p>Эти параметры управляет функциями сбора статистики на уровне сервера. Когда ведётся сбор статистики, собираемые данные можно просмотреть в семействе системных представлений <code class="structname">pg_stat</code> и <code class="structname">pg_statio</code>. За дополнительными сведениями обратитесь к <a class="xref" href="ch28.html" title="Глава 28. Мониторинг работы СУБД">Главе 28</a>.</p><div class="variablelist"><dl class="variablelist"><dt><a id="guc-track-activities"/><span class="term"><code class="varname">track_activities</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.2.3.1.1.3" class="indexterm"/></span></dt><dd><p>Включает сбор сведений о текущих командах, выполняющихся во всех сеансах (в частности, отслеживается идентификатор и время запуска команды). По умолчанию этот параметр включён. Заметьте, что даже когда сбор ведётся, собранная информация доступна не для всех пользователей, а только для суперпользователей и пользователей, имеющих права роли <code class="literal">pg_read_all_stats</code>. Также пользователям доступна информация о командах в их сеансах (включая сеансы ролей, в которые эти пользователи включены). Поэтому это не должно повлечь риски, связанные с безопасностью. Изменить этот параметр могут только суперпользователи.</p></dd><dt><a id="guc-track-activity-query-size"/><span class="term"><code class="varname">track_activity_query_size</code> (<code class="type">integer</code>) <a id="id-1.6.7.12.2.3.2.1.3" class="indexterm"/></span></dt><dd><p>Задаёт объём памяти, резервируемой для хранения текста выполняемой в данной момент команды в каждом активном сеансе, для поля <code class="structname">pg_stat_activity</code>.<code class="structfield">query</code>. Если это значение задаётся без единиц измерения, оно считается заданным в байтах. Значение по умолчанию — 1024 байта. Задать этот параметр можно только при запуске сервера.</p></dd><dt><a id="guc-track-counts"/><span class="term"><code class="varname">track_counts</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.2.3.3.1.3" class="indexterm"/></span></dt><dd><p>Включает сбор статистики активности в базе данных. Этот параметр по умолчанию включён, так как собранная информация требуется демону автоочистки. Изменить этот параметр могут только суперпользователи.</p></dd><dt><a id="guc-track-io-timing"/><span class="term"><code class="varname">track_io_timing</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.2.3.4.1.3" class="indexterm"/></span></dt><dd><p>Включает замер времени операций ввода/вывода. Этот параметр по умолчанию отключён, так как для данного замера требуется постоянно запрашивать текущее время у операционной системы, что может значительно замедлить работу на некоторых платформах. Для оценивания издержек замера времени на вашей платформе можно воспользоваться утилитой <a class="xref" href="rn03re281.html" title="pg_test_timing"><span class="refentrytitle"><span class="application">pg_test_timing</span></span></a>. Статистику ввода/вывода можно получить через представление <a class="link" href="ch28s02.html#monitoring-pg-stat-database-view" title="28.2.13. pg_stat_database"><code class="structname">pg_stat_database</code></a>, в выводе <a class="xref" href="rn01re216.html" title="EXPLAIN"><span class="refentrytitle">EXPLAIN</span></a> (когда используется параметр <code class="literal">BUFFERS</code>), от процесса автоочистки, выполняющего операции очистки и сбора статистики, когда установлен параметр <a class="xref" href="ch20s08.html#guc-log-autovacuum-min-duration">log_autovacuum_min_duration</a>, и через представление <a class="xref" href="apfs30.html" title="F.30. pg_stat_statements">pg_stat_statements</a>. Изменить этот параметр могут только суперпользователи.</p></dd><dt><a id="guc-track-wal-io-timing"/><span class="term"><code class="varname">track_wal_io_timing</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.2.3.5.1.3" class="indexterm"/></span></dt><dd><p>Включает замер времени операций ввода/вывода WAL. Этот параметр по умолчанию отключён, так как для данного замера требуется постоянно запрашивать текущее время у операционной системы, что может значительно замедлить работу на некоторых платформах. Для оценивания издержек замера времени на вашей платформе можно воспользоваться утилитой <span class="application">pg_test_timing</span>. Статистику ввода/вывода можно получить через представление <a class="link" href="ch28s02.html#monitoring-pg-stat-database-view" title="28.2.13. pg_stat_database"><code class="structname">pg_stat_wal</code></a>. Изменить этот параметр могут только суперпользователи.</p></dd><dt><a id="guc-track-functions"/><span class="term"><code class="varname">track_functions</code> (<code class="type">enum</code>) <a id="id-1.6.7.12.2.3.6.1.3" class="indexterm"/></span></dt><dd><p>Включает подсчёт вызовов функций и времени их выполнения. Значение <code class="literal">pl</code> включает отслеживание только функций на процедурном языке, а <code class="literal">all</code> — также функций на языках SQL и C. Значение по умолчанию — <code class="literal">none</code>, то есть сбор статистики по функциям отключён. Изменить этот параметр могут только суперпользователи.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>Функции на языке SQL, достаточно простые для <span class="quote">«<span class="quote">внедрения</span>»</span> в вызывающий запрос, отслеживаться не будут вне зависимости от этого параметра.</p></div></dd><dt><a id="guc-stats-temp-directory"/><span class="term"><code class="varname">stats_temp_directory</code> (<code class="type">string</code>) <a id="id-1.6.7.12.2.3.7.1.3" class="indexterm"/></span></dt><dd><p>Задаёт каталог, в котором будут храниться временные данные статистики. Этот путь может быть абсолютным или задаваться относительно каталога данных. Значение по умолчанию — <code class="filename">pg_stat_tmp</code>. Если разместить целевой каталог в файловой системе в ОЗУ, это снизит нагрузку на физическое дисковое хранилище и может увеличить быстродействие. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="runtime-config-statistics-monitor"/>20.9.2. Мониторинг статистики</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><a id="guc-compute-query-id"/><span class="term"><code class="varname">compute_query_id</code> (<code class="type">enum</code>) <a id="id-1.6.7.12.3.2.1.1.3" class="indexterm"/></span></dt><dd><p>Включает вычисление идентификатора запроса в ядре. Идентификаторы запроса могут отображаться в представлении <a class="link" href="ch28s02.html#monitoring-pg-stat-activity-view" title="28.2.3. pg_stat_activity"><code class="structname">pg_stat_activity</code></a> в выводе <span class="command"><strong>EXPLAIN</strong></span> или записываться в журнал, при заданным соответствующим образом параметре <a class="xref" href="ch20s08.html#guc-log-line-prefix">log_line_prefix</a>. Идентификаторы запросов также должны вычисляться для расширения <a class="xref" href="apfs30.html" title="F.30. pg_stat_statements">pg_stat_statements</a>. Обратите внимание, что в качестве альтернативы можно использовать внешний модуль, если метод вычисления идентификатора запроса в ядре является неприемлемым. Это вычисление в ядре нужно полностью отключить. Допустимые значения: <code class="literal">off</code> (всегда отключено); <code class="literal">on</code> (всегда включено); <code class="literal">auto</code>, которое позволяет таким модулям, как <a class="xref" href="apfs30.html" title="F.30. pg_stat_statements">pg_stat_statements</a>, автоматически включить данное вычисление; <code class="literal">regress</code>, которое действует так же, как <code class="literal">auto</code>, но идентификатор запроса не показывается в выводе команды <code class="literal">EXPLAIN</code>, что облегчает автоматическое регрессионное тестирование. По умолчанию значение этого параметра — <code class="literal">auto</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>Чтобы для запроса гарантированно вычислялся и отображался только один идентификатор, вычисляющие его расширения должны выдавать ошибку, если идентификатор запроса уже был вычислен.</p></div></dd><dt><span class="term"><code class="varname">log_statement_stats</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.3.2.2.1.3" class="indexterm"/><br/></span><span class="term"><code class="varname">log_parser_stats</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.3.2.2.2.3" class="indexterm"/><br/></span><span class="term"><code class="varname">log_planner_stats</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.3.2.2.3.3" class="indexterm"/><br/></span><span class="term"><code class="varname">log_executor_stats</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.3.2.2.4.3" class="indexterm"/></span></dt><dd><p>Эти параметры включают вывод статистики по производительности соответствующего модуля в протокол работы сервера. Это грубый инструмент профилирования, похожий на функцию <code class="function">getrusage()</code> в операционной системе. Параметр <code class="varname">log_statement_stats</code> включает вывод общей статистики по операторам, тогда как другие управляют статистикой по модулям (разбор, планирование, выполнение). Включить <code class="varname">log_statement_stats</code> одновременно с параметрами, управляющими модулями, нельзя. По умолчанию все эти параметры отключены. Изменить эти параметры могут только суперпользователи.</p></dd></dl></div></div></div></body></html>