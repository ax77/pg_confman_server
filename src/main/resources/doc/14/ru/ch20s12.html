<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>20.12. Управление блокировками</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="runtime-config-locks"/>20.12. Управление блокировками</h1></div></div></div><div class="variablelist"><dl class="variablelist"><dt><a id="guc-deadlock-timeout"/><span class="term"><code class="varname">deadlock_timeout</code> (<code class="type">integer</code>) <a id="id-1.6.7.15.2.1.1.3" class="indexterm"/> <a id="id-1.6.7.15.2.1.1.4" class="indexterm"/> <a id="id-1.6.7.15.2.1.1.5" class="indexterm"/></span></dt><dd><p>Время ожидания блокировки, по истечении которого будет выполняться проверка состояния взаимоблокировки. Эта проверка довольно дорогостоящая, поэтому сервер не выполняет её при всяком ожидании блокировки. Мы оптимистично полагаем, что взаимоблокировки редки в производственных приложениях, и поэтому просто ждём некоторое время, прежде чем пытаться выявить взаимоблокировку. При увеличении значения этого параметра сокращается время, уходящее на ненужные проверки взаимоблокировки, но замедляется реакция на реальные взаимоблокировки. Если это значение задаётся без единиц измерения, оно считается заданным в миллисекундах. Значение по умолчанию — одна секунда (<code class="literal">1s</code>), что близко к минимальному значению, которое стоит применять на практике. На сервере с большой нагрузкой имеет смысл увеличить его. В идеале это значение должно превышать типичное время транзакции, чтобы повысить шансы на то, что блокировка всё-таки будет освобождена, прежде чем ожидающая транзакция решит проверить состояние взаимоблокировки. Изменить этот параметр могут только суперпользователи.</p><p>Когда включён параметр <a class="xref" href="ch20s08.html#guc-log-lock-waits">log_lock_waits</a>, данный параметр также определяет, спустя какое время в журнал сервера будут записываться сообщения об ожидании блокировки. Если вы пытаетесь исследовать задержки, вызванные блокировками, имеет смысл уменьшить его по сравнению с обычным значением <code class="varname">deadlock_timeout</code>.</p></dd><dt><a id="guc-max-locks-per-transaction"/><span class="term"><code class="varname">max_locks_per_transaction</code> (<code class="type">integer</code>) <a id="id-1.6.7.15.2.2.1.3" class="indexterm"/></span></dt><dd><p>Общая таблица блокировок отслеживает блокировки для <code class="varname">max_locks_per_transaction</code> * (<a class="xref" href="ch20s03.html#guc-max-connections">max_connections</a> + <a class="xref" href="ch20s04.html#guc-max-prepared-transactions">max_prepared_transactions</a>) объектов (например, таблиц); таким образом, в любой момент времени может быть заблокировано не больше этого числа различных объектов. Этот параметр управляет средним числом блокировок объектов, выделяемым для каждой транзакции; отдельные транзакции могут заблокировать и больше объектов, если все они умещаются в таблице блокировок. Заметьте, что это <span class="emphasis"><em>не</em></span> число строк, которое может быть заблокировано; их количество не ограничено. Значение по умолчанию, 64, как показала практика, вполне приемлемо, но может возникнуть потребность его увеличить, если запросы обращаются ко множеству различных таблиц в одной транзакции, как например, запрос к родительской таблице со многими потомками. Этот параметр можно задать только при запуске сервера.</p><p>Для ведомого сервера значение этого параметра должно быть больше или равно значению на ведущем. В противном случае на ведомом сервере не будут разрешены запросы.</p></dd><dt><a id="guc-max-pred-locks-per-transaction"/><span class="term"><code class="varname">max_pred_locks_per_transaction</code> (<code class="type">integer</code>) <a id="id-1.6.7.15.2.3.1.3" class="indexterm"/></span></dt><dd><p>Общая таблица предикатных блокировок отслеживает блокировки для <code class="varname">max_pred_locks_per_transaction</code> * (<a class="xref" href="ch20s03.html#guc-max-connections">max_connections</a> + <a class="xref" href="ch20s04.html#guc-max-prepared-transactions">max_prepared_transactions</a>) объектов (например, таблиц); таким образом, в один момент времени может быть заблокировано не больше этого числа различных объектов. Этот параметр управляет средним числом блокировок объектов, выделяемым для каждой транзакции; отдельные транзакции могут заблокировать и больше объектов, если все они умещаются в таблице блокировок. Заметьте, что это <span class="emphasis"><em>не</em></span> число строк, которое может быть заблокировано; их количество не ограничено. Значение по умолчанию, 64, как показала практика, вполне приемлемо, но может возникнуть потребность его увеличить, если запросы обращаются ко множеству различных таблиц в одной сериализуемой транзакции, как например, запрос к родительской таблице со многими потомками. Этот параметр можно задать только при запуске сервера.</p></dd><dt><a id="guc-max-pred-locks-per-relation"/><span class="term"><code class="varname">max_pred_locks_per_relation</code> (<code class="type">integer</code>) <a id="id-1.6.7.15.2.4.1.3" class="indexterm"/></span></dt><dd><p>Этот параметр определяет, для скольких страниц или кортежей одного отношения могут устанавливаться предикатные блокировки, прежде чем вместо них будет затребована одна блокировка для всего отношения. Значения, большие или равные нулю, задают абсолютный предел, а с отрицательным значением пределом будет значение <a class="xref" href="ch20s12.html#guc-max-pred-locks-per-transaction">max_pred_locks_per_transaction</a>, делённое на модуль данного. По умолчанию действует значение -2, что даёт то же поведение, что наблюдалось в предыдущих версиях <span class="productname">PostgreSQL</span>. Этот параметр можно задать только в файле <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt><a id="guc-max-pred-locks-per-page"/><span class="term"><code class="varname">max_pred_locks_per_page</code> (<code class="type">integer</code>) <a id="id-1.6.7.15.2.5.1.3" class="indexterm"/></span></dt><dd><p>Этот параметр определяет, для скольких строк на одной странице могут устанавливаться предикатные блокировки, прежде чем вместо них будет затребована одна блокировка для всей страницы. Этот параметр можно задать только в файле <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd></dl></div></div></body></html>